# 신규 게임 만들기 가이드

이 문서는 "게임세상" 포털에 새로운 게임을 추가하는 전체 프로세스를 안내합니다.

## 목차
1. [사전 준비](#사전-준비)
2. [게임 파일 생성](#게임-파일-생성)
3. [index.html 게임 목록 추가](#indexhtml-게임-목록-추가)
4. [games.json 다국어 정보 추가](#gamesjson-다국어-정보-추가)
5. [Supabase 게임 테이블 추가](#supabase-게임-테이블-추가)
6. [체크리스트](#체크리스트)

---

## 사전 준비

### 게임 기획
- 게임 메커니즘 정의
- 조작 방법 (터치/마우스)
- 점수 시스템
- 난이도 곡선

### 필수 참조 문서
- [게임인트로.md](게임인트로.md) - 메뉴/게임오버 화면 구조
- [게임메인헤더.md](게임메인헤더.md) - 게임 플레이 화면 헤더
- [CLAUDE.md](CLAUDE.md) - 프로젝트 전체 가이드

### 파일명 규칙
- 영문 소문자 + 언더스코어
- 예: `dart_game.html`, `space_shooter.html`
- 출시 날짜: 현재 날짜 또는 계획된 출시일

---

## 게임 파일 생성

### 1. HTML 기본 구조 템플릿

```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <title>게임 이름</title>

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabaseClient.js"></script>
</head>
<body>
    <!-- 메뉴 화면 -->
    <div id="menuScreen" class="menu-screen">
        <div class="menu-header">
            <a href="index.html" class="menu-back-btn">
                <span class="material-icons">arrow_back</span>
            </a>
            <div class="menu-game-title">게임 이름</div>
            <div class="menu-points">
                <span>🏆</span>
                <span id="menuPoints">0</span>
            </div>
        </div>

        <div class="menu-body">
            <div class="menu-content">
                <!-- 게임 시작 버튼 (최상단) -->
                <button class="start-btn" onclick="startGame()">게임 시작</button>

                <!-- 게임 소개 -->
                <div class="intro-section">
                    <h2>🎯 게임 방법</h2>
                    <ul>
                        <li>게임 조작법 설명 1</li>
                        <li>게임 조작법 설명 2</li>
                    </ul>
                </div>

                <div class="intro-section">
                    <h2>🏆 점수 획득</h2>
                    <ul>
                        <li>점수 시스템 설명</li>
                    </ul>
                </div>

                <div class="intro-section">
                    <h2>⚡ 팁</h2>
                    <ul>
                        <li>게임 팁 1</li>
                        <li>게임 팁 2</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- 게임 화면 -->
    <div id="gameContainer" class="game-container hidden">
        <!-- 상단 헤더 -->
        <div class="stats">
            <a href="#" class="back-btn-game" onclick="handleGameExit(event)">
                <span class="material-icons">arrow_back</span>
            </a>
            <div class="stat-item">
                <div class="stat-label">Score</div>
                <div class="stat-value" id="score">0</div>
            </div>
            <!-- 필요한 경우 추가 스탯 -->
        </div>

        <!-- 게임 캔버스 -->
        <canvas id="gameCanvas"></canvas>
    </div>

    <!-- 게임오버 화면 -->
    <div id="gameoverScreen" class="menu-screen hidden">
        <div class="menu-header">
            <a href="index.html" class="menu-back-btn">
                <span class="material-icons">arrow_back</span>
            </a>
            <div class="menu-game-title">게임 오버</div>
            <div class="menu-points">
                <span>🏆</span>
                <span id="gameoverPoints">0</span>
            </div>
        </div>

        <div class="menu-body">
            <div class="menu-content">
                <div class="gameover-title">Game Over</div>

                <div class="score-info">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>이번판 점수</span>
                        <span style="color: #ffcc00; font-weight: bold;" id="finalScore">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>통합 포인트</span>
                        <span style="color: #00ff00; font-weight: bold;" id="totalPoints">0</span>
                    </div>
                    <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <div style="display: flex; justify-content: space-between;">
                            <span>최고 점수</span>
                            <span style="color: #ff6b6b; font-weight: bold;" id="highScore">0</span>
                        </div>
                    </div>
                </div>

                <button class="start-btn" onclick="restartGame()">다시 하기</button>
            </div>
        </div>
    </div>
</body>
</html>
```

### 2. CSS 스타일 (필수)

```css
<style>
    :root {
        --vh: 1vh;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        color: white;
        overflow: hidden;
        height: 100vh;
        height: calc(var(--vh, 1vh) * 100);
        touch-action: none;
    }

    /* 메뉴 화면 (게임인트로.md 참조) */
    .menu-screen {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100vh;
        height: calc(var(--vh, 1vh) * 100);
        overflow: hidden;
    }

    .menu-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        background: rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .menu-back-btn {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        text-decoration: none;
        color: white;
        transition: all 0.3s ease;
        flex-shrink: 0;
    }

    .menu-back-btn:hover,
    .menu-back-btn:active {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(0.95);
    }

    .menu-game-title {
        flex: 1;
        text-align: center;
        font-size: 18px;
        font-weight: bold;
        color: #ffffff;
    }

    .menu-points {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 16px;
        font-weight: bold;
        color: #ffd700;
        flex-shrink: 0;
    }

    .menu-body {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        overflow-y: auto;
        padding: 20px 0;
    }

    .menu-content {
        width: 90%;
        max-width: 600px;
        padding: 0 20px;
    }

    .intro-section {
        padding: 20px 0;
        margin-bottom: 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        text-align: left;
    }

    .intro-section:last-of-type {
        border-bottom: none;
    }

    .intro-section h2 {
        margin-bottom: 12px;
        font-size: 20px;
        text-align: left;
    }

    .intro-section ul {
        list-style: disc;
        padding-left: 20px;
        margin: 0;
    }

    .intro-section li {
        margin: 8px 0;
        line-height: 1.6;
        opacity: 0.9;
    }

    .intro-section p {
        margin: 8px 0;
        line-height: 1.6;
        opacity: 0.9;
        text-align: left;
    }

    .start-btn {
        width: 100%;
        padding: 16px;
        font-size: 18px;
        font-weight: bold;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        margin-bottom: 20px;
    }

    .start-btn:hover,
    .start-btn:active {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    /* 게임 화면 */
    .game-container {
        width: 100%;
        height: 100vh;
        height: calc(var(--vh, 1vh) * 100);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .game-container.hidden {
        display: none;
    }

    /* 게임 헤더 (게임메인헤더.md 참조) */
    .stats {
        display: flex;
        align-items: center;
        padding: 8px 12px;
        background: rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        gap: 12px;
    }

    .back-btn-game {
        background: transparent;
        border: none;
        color: #ffd700;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-right: 4px;
    }

    .back-btn-game .material-icons {
        font-size: 24px;
    }

    .back-btn-game:hover {
        background: rgba(255, 215, 0, 0.1);
    }

    .back-btn-game:active {
        background: rgba(255, 215, 0, 0.2);
    }

    .stat-item {
        flex: 1;
        text-align: center;
    }

    .stat-item:first-of-type {
        margin-left: auto;
    }

    .stat-label {
        font-size: 12px;
        opacity: 0.7;
        margin-bottom: 2px;
    }

    .stat-value {
        font-size: 18px;
        font-weight: bold;
        color: #ffd700;
    }

    /* 캔버스 */
    #gameCanvas {
        flex: 1;
        display: block;
        width: 100%;
        background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
        touch-action: none;
    }

    /* 게임오버 화면 */
    .gameover-title {
        font-size: 36px;
        font-weight: bold;
        text-align: center;
        margin-bottom: 30px;
        color: #ff6b6b;
        text-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
    }

    .score-info {
        background: rgba(255, 255, 255, 0.05);
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .hidden {
        display: none !important;
    }

    /* 모바일 뷰포트 높이 fix */
    @media screen and (max-width: 768px) {
        .menu-game-title {
            font-size: 16px;
        }

        .menu-points {
            font-size: 14px;
        }
    }
</style>
```

### 3. JavaScript 필수 구조

```javascript
<script>
    // ============================================
    // 모바일 뷰포트 높이 fix
    // ============================================
    function setViewportHeight() {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
    }

    window.addEventListener('resize', setViewportHeight);
    window.addEventListener('orientationchange', setViewportHeight);
    setViewportHeight();

    // ============================================
    // Supabase 함수들 (window 전역 함수 사용)
    // ============================================
    // ⚠️ 중요: _supabaseClient를 직접 사용하지 말고,
    // js/supabaseClient.js에서 제공하는 window 전역 함수를 사용하세요!

    async function updatePointsDisplay() {
        // window.getCurrentPoints()는 js/supabaseClient.js에서 제공
        const points = window.getCurrentPoints ? window.getCurrentPoints() : 0;
        const menuPointsEl = document.getElementById('menuPoints');
        const gameoverPointsEl = document.getElementById('gameoverPoints');

        if (menuPointsEl) menuPointsEl.textContent = points;
        if (gameoverPointsEl) gameoverPointsEl.textContent = points;
    }

    // ============================================
    // 게임 변수
    // ============================================
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    let gameState = 'menu'; // 'menu', 'playing', 'gameover', 'exiting'
    let score = 0; // 이번 판 점수 (게임 시작 시 0부터)
    let highScore = parseInt(localStorage.getItem('게임파일명_highScore')) || 0;

    // 게임 전용 변수들
    // ...

    // ============================================
    // 게임 시작
    // ============================================
    window.startGame = async function() {
        score = 0; // 이번 판 점수는 0부터 시작
        gameState = 'playing';

        // 화면 전환
        document.getElementById('menuScreen').classList.add('hidden');
        document.getElementById('gameContainer').classList.remove('hidden');
        document.getElementById('gameoverScreen').classList.add('hidden');

        // 게임 초기화
        initGame();

        // 포인트 표시 업데이트
        await updatePointsDisplay();

        resizeCanvas();
        gameLoop();
    };

    // ============================================
    // 게임 재시작
    // ============================================
    window.restartGame = function() {
        startGame();
    };

    // ============================================
    // 게임 종료 (이전 버튼)
    // ============================================
    async function handleGameExit(event) {
        event.preventDefault();

        if (gameState === 'playing' && confirm('게임을 종료하시겠습니까?\n현재 점수가 통합 포인트에 저장됩니다.')) {
            gameState = 'exiting';

            // 점수 저장
            if (window.addGamePoints) {
                await window.addGamePoints(score, '게임파일명.html');
            }
            await updatePointsDisplay();

            // 메뉴로 돌아가기
            document.getElementById('gameContainer').classList.add('hidden');
            document.getElementById('menuScreen').classList.remove('hidden');
            gameState = 'menu';
        }
    }

    // ============================================
    // 게임 오버
    // ============================================
    async function gameOver() {
        gameState = 'gameover';

        // 최고 점수 업데이트
        if (score > highScore) {
            highScore = score;
            localStorage.setItem('게임파일명_highScore', highScore);
        }

        // 점수 저장 및 표시
        let totalPoints = 0;
        if (window.addGamePoints) {
            const result = await window.addGamePoints(score, '게임파일명.html');
            totalPoints = result?.newTotal || 0;
        }
        await updatePointsDisplay();

        // 게임오버 화면에 점수 표시
        document.getElementById('finalScore').textContent = score;
        document.getElementById('totalPoints').textContent = totalPoints;
        document.getElementById('highScore').textContent = highScore;

        // 화면 전환
        document.getElementById('gameContainer').classList.add('hidden');
        document.getElementById('gameoverScreen').classList.remove('hidden');
    }

    // ============================================
    // 게임 초기화
    // ============================================
    function initGame() {
        // 게임 상태 초기화
        // ...
    }

    // ============================================
    // 캔버스 리사이즈
    // ============================================
    function resizeCanvas() {
        const stats = document.querySelector('.stats');
        if (!stats) return;

        const statsHeight = stats.offsetHeight;
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight - statsHeight;
    }

    window.addEventListener('resize', resizeCanvas);
    window.addEventListener('orientationchange', resizeCanvas);

    // ============================================
    // 게임 루프
    // ============================================
    function gameLoop() {
        if (gameState === 'playing') {
            updateGame();
            drawGame();
        }
        requestAnimationFrame(gameLoop);
    }

    function updateGame() {
        // 게임 로직 업데이트
        // ...

        // 점수 표시 업데이트
        const scoreEl = document.getElementById('score');
        if (scoreEl) scoreEl.textContent = score;
    }

    function drawGame() {
        // 캔버스 그리기
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 게임 객체들 그리기
        // ...
    }

    // ============================================
    // 터치/마우스 이벤트
    // ============================================
    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        handleTouchStart(e.touches[0]);
    });

    canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
        handleTouchMove(e.touches[0]);
    });

    canvas.addEventListener('touchend', (e) => {
        e.preventDefault();
        handleTouchEnd();
    });

    canvas.addEventListener('mousedown', (e) => {
        handleTouchStart(e);
    });

    canvas.addEventListener('mousemove', (e) => {
        handleTouchMove(e);
    });

    canvas.addEventListener('mouseup', () => {
        handleTouchEnd();
    });

    function handleTouchStart(touch) {
        if (gameState !== 'playing') return;
        // 터치 시작 처리
    }

    function handleTouchMove(touch) {
        if (gameState !== 'playing') return;
        // 터치 이동 처리
    }

    function handleTouchEnd() {
        if (gameState !== 'playing') return;
        // 터치 종료 처리
    }

    // ============================================
    // 초기화
    // ============================================
    window.addEventListener('load', async () => {
        // ⚠️ 중요: Supabase 초기화 대기 (포인트 표시를 위해 필수)
        if (window.waitForSupabaseInit) {
            await window.waitForSupabaseInit();
        }

        await updatePointsDisplay();

        // 조회수 증가
        if (window.incrementGameView) {
            await window.incrementGameView('게임파일명.html');
        }
    });
</script>
```

---

## index.html 게임 목록 추가

### 게임 카드 추가 위치

`index.html` 파일에서 해당 카테고리의 게임 목록 섹션을 찾아 새 게임 카드를 추가합니다.

```html
<!-- 예: 아케이드 게임 섹션 -->
<div class="game-grid" id="arcadeGames">
    <!-- 기존 게임들... -->

    <!-- 새 게임 추가 -->
    <div class="game-card"
         data-category="arcade"
         data-name-ko="다트 게임"
         data-name-en="Dart Game"
         data-name-zh="飞镖游戏"
         data-name-es="Juego de Dardos"
         data-name-pt="Jogo de Dardos"
         data-release="2025-10-10"
         onclick="openGame('dart_game.html')">
        <div class="game-icon">🎯</div>
        <div class="game-title" data-key="dartGame">다트 게임</div>
        <div class="game-views">
            <span>👁️</span>
            <span class="view-count" data-game="dart_game.html">0</span>
        </div>
    </div>
</div>
```

### 주요 속성 설명

- `data-category`: 게임 카테고리 (action, puzzle, arcade, rhythm, casual, strategy)
- `data-name-xx`: 각 언어별 게임 이름
- `data-release`: 출시일 (YYYY-MM-DD 형식)
- `onclick="openGame('파일명.html')"`: 클릭 시 열릴 게임 파일
- `data-key`: translations.json의 키 (다국어 지원용)
- `data-game`: 조회수 표시용 게임 URL

---

## games.json 다국어 정보 추가

`games.json` 파일에 새 게임의 다국어 정보를 추가합니다.

```json
{
    "ko": {
        // ... 기존 게임들 ...
        "dartGame": "다트 게임"
    },
    "en": {
        // ... 기존 게임들 ...
        "dartGame": "Dart Game"
    },
    "zh-CN": {
        // ... 기존 게임들 ...
        "dartGame": "飞镖游戏"
    },
    "es": {
        // ... 기존 게임들 ...
        "dartGame": "Juego de Dardos"
    },
    "pt": {
        // ... 기존 게임들 ...
        "dartGame": "Jogo de Dardos"
    }
}
```

---

## Supabase 게임 테이블 추가

`migration_add_games_table.sql` 파일 또는 Supabase SQL Editor에서 새 게임 데이터를 추가합니다.

```sql
-- games 테이블에 새 게임 추가
INSERT INTO public.games (game_url, release_date) VALUES
('dart_game.html', '2025-10-10');
```

또는 기존 데이터와 함께 일괄 추가:

```sql
INSERT INTO public.games (game_url, release_date) VALUES
('dart_game.html', '2025-10-10')
ON CONFLICT (game_url) DO NOTHING;
```

---

## 체크리스트

### 게임 파일 생성
- [ ] HTML 기본 구조 작성
- [ ] CSS 스타일 적용 (게임인트로.md 참조)
- [ ] JavaScript 게임 로직 구현
- [ ] 모바일 뷰포트 높이 fix 적용
- [ ] Material Icons 링크 추가
- [ ] Supabase Client 스크립트 추가

### 화면 구성
- [ ] 메뉴 화면 (menu-header + menu-body)
- [ ] 게임 화면 (게임 헤더 + 캔버스)
- [ ] 게임오버 화면 (점수 표시 + 다시하기)
- [ ] 이전 버튼 (메뉴, 게임, 게임오버 모두)

### 점수 시스템
- [ ] `score` 변수 (이번 판 점수, 0부터 시작)
- [ ] `highScore` localStorage 저장
- [ ] `getCurrentPoints()` 구현
- [ ] `addGamePoints()` 구현
- [ ] `updatePointsDisplay()` 구현
- [ ] 게임오버 시 이번판 점수 + 통합 포인트 표시
- [ ] 이전 버튼으로 나갈 때 점수 저장

### 게임 로직
- [ ] `gameState` 상태 관리 (menu, playing, gameover, exiting)
- [ ] `initGame()` 게임 초기화
- [ ] `startGame()` 게임 시작
- [ ] `restartGame()` 게임 재시작
- [ ] `handleGameExit()` 게임 종료
- [ ] `gameOver()` 게임오버 처리
- [ ] `gameLoop()` 게임 루프
- [ ] `updateGame()` 게임 업데이트
- [ ] `drawGame()` 캔버스 렌더링

### 입력 처리
- [ ] 터치 이벤트 (touchstart, touchmove, touchend)
- [ ] 마우스 이벤트 (mousedown, mousemove, mouseup)
- [ ] `e.preventDefault()` 스크롤 방지
- [ ] 게임 상태에 따른 입력 처리

### 통합
- [ ] index.html 게임 카드 추가
- [ ] games.json 다국어 이름 추가 (5개 언어)
- [ ] Supabase games 테이블에 게임 추가
- [ ] 게임 파일명 일치 확인 (HTML, index.html, games.json, SQL)

### 테스트
- [ ] 모바일 터치 동작 확인
- [ ] PC 마우스 동작 확인
- [ ] 점수 시스템 동작 확인
- [ ] 화면 전환 확인 (메뉴 → 게임 → 게임오버)
- [ ] 이전 버튼 동작 확인 (점수 저장 포함)
- [ ] 다국어 표시 확인
- [ ] 조회수 증가 확인
- [ ] 다양한 화면 크기 테스트

### Git 커밋
- [ ] 게임 파일 추가
- [ ] index.html 수정
- [ ] games.json 수정
- [ ] SQL 마이그레이션 파일 수정 (필요시)
- [ ] 커밋 메시지 작성 (영문 요약 + 한글 상세)

```bash
git add .
git commit -m "$(cat <<'EOF'
Add new game: Dart Game

다트 게임 추가:
- 터치/드래그로 다트 조준 및 발사
- 과녁 점수 시스템
- 게임인트로.md, 게임메인헤더.md 패턴 적용
- index.html 게임 목록 추가
- games.json 다국어 지원 추가
- Supabase games 테이블 추가

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

---

## 참고 사항

### 파일명 규칙
- 영문 소문자 + 언더스코어 사용
- HTML 파일명과 모든 참조가 일치해야 함
- 예: `dart_game.html` (파일), `dart_game.html` (index.html), `dart_game.html` (SQL)

### 출시일 규칙
- YYYY-MM-DD 형식
- 현재 날짜 또는 계획된 출시일
- index.html의 `data-release`와 SQL의 `release_date`가 일치해야 함

### 이모지 선택
- 게임 특성을 나타내는 이모지 선택
- 예: 🎯 (다트), 🚀 (우주), ⚔️ (전투), 🧩 (퍼즐)

### 카테고리 선택
- **action**: 액션, 슈팅, 전투 게임
- **puzzle**: 퍼즐, 두뇌 게임
- **arcade**: 아케이드, 캐주얼 아케이드
- **rhythm**: 리듬, 음악 게임
- **casual**: 캐주얼, 타이밍 게임
- **strategy**: 전략, 보드 게임

### 점수 시스템 중요 사항
1. **이번 판 점수 (`score`)**: 매 게임 시작 시 0부터 시작
2. **통합 포인트**: Supabase에 누적 저장
3. **최고 점수**: localStorage에 저장
4. **게임오버 시**: 이번판 점수 + 통합 포인트 모두 표시
5. **이전 버튼**: 게임 중 나갈 때도 점수 저장

---

## 개발 체크리스트 (실제 개발 순서대로)

신규 게임을 만들 때 이 순서대로 진행하면 오류를 최소화할 수 있습니다.

### Phase 1: 파일 생성 및 기본 구조

- [ ] 1. **게임 파일명 결정** (예: `dart_game.html`)
  - 영문 소문자 + 언더스코어
  - 파일명을 모든 곳에서 일관되게 사용

- [ ] 2. **HTML 기본 구조 작성**
  ```html
  <!DOCTYPE html>
  <html lang="ko">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
      <meta name="mobile-web-app-capable" content="yes">
      <meta name="apple-mobile-web-app-capable" content="yes">
      <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
      <meta name="theme-color" content="#1a1a2e">
      <title>게임 이름</title>

      <!-- Material Icons -->
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

      <!-- Supabase (중요: 순서 지킬 것!) -->
      <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
      <script src="js/supabaseClient.js"></script>
  </head>
  ```

- [ ] 3. **CSS 기본 스타일 복사**
  - 기존 게임 파일에서 CSS 섹션 복사
  - `:root { --vh: 1vh; }` 포함 확인
  - `.hidden { display: none !important; }` 포함 확인

- [ ] 4. **세 가지 화면 HTML 구조 작성**
  - 메뉴 화면 (`#menuScreen`)
  - 게임 화면 (`#gameContainer`)
  - 게임오버 화면 (`#gameoverScreen`)

### Phase 2: JavaScript 기본 설정

- [ ] 5. **모바일 뷰포트 높이 fix**
  ```javascript
  function setViewportHeight() {
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
  }
  window.addEventListener('resize', setViewportHeight);
  window.addEventListener('orientationchange', setViewportHeight);
  setViewportHeight();
  ```

- [ ] 6. **Supabase 함수들 (⚠️ 중요)**
  ```javascript
  // ⚠️ window 전역 함수 사용!
  async function updatePointsDisplay() {
      const points = window.getCurrentPoints ? window.getCurrentPoints() : 0;
      const menuPointsEl = document.getElementById('menuPoints');
      const gameoverPointsEl = document.getElementById('gameoverPoints');

      if (menuPointsEl) menuPointsEl.textContent = points;
      if (gameoverPointsEl) gameoverPointsEl.textContent = points;
  }
  ```

- [ ] 7. **게임 변수 초기화**
  ```javascript
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  let gameState = 'menu';
  let score = 0;
  let highScore = parseInt(localStorage.getItem('게임파일명_highScore')) || 0;
  ```

### Phase 3: 게임 로직 구현

- [ ] 8. **게임 초기화 함수**
  ```javascript
  function initGame() {
      // 게임 상태 초기화
  }
  ```

- [ ] 9. **게임 시작 함수**
  ```javascript
  window.startGame = async function() {
      score = 0;
      gameState = 'playing';

      document.getElementById('menuScreen').classList.add('hidden');
      document.getElementById('gameContainer').classList.remove('hidden');
      document.getElementById('gameoverScreen').classList.add('hidden');

      initGame();
      await updatePointsDisplay();

      resizeCanvas();
      gameLoop();
  };
  ```

- [ ] 10. **게임 루프 구현**
  ```javascript
  function gameLoop() {
      if (gameState === 'playing') {
          updateGame();
          drawGame();
      }
      requestAnimationFrame(gameLoop);
  }
  ```

- [ ] 11. **캔버스 리사이즈 처리**
  ```javascript
  function resizeCanvas() {
      const stats = document.querySelector('.stats');
      if (!stats) {
          console.warn('Stats element not found');
          return;
      }
      const statsHeight = stats.offsetHeight;
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight - statsHeight;
  }

  window.addEventListener('resize', resizeCanvas);
  window.addEventListener('orientationchange', resizeCanvas);
  ```

- [ ] 12. **터치/마우스 이벤트 (⚠️ preventDefault 필수)**
  ```javascript
  canvas.addEventListener('touchstart', (e) => {
      e.preventDefault(); // 필수!
      if (gameState !== 'playing') return;
      handleTouchStart(e.touches[0]);
  });

  canvas.addEventListener('touchmove', (e) => {
      e.preventDefault(); // 필수!
      if (gameState !== 'playing') return;
      handleTouchMove(e.touches[0]);
  });

  canvas.addEventListener('mousedown', (e) => {
      if (gameState !== 'playing') return;
      handleTouchStart(e);
  });
  ```

### Phase 4: 점수 시스템 구현

- [ ] 13. **게임 종료 시 점수 저장 (⚠️ 중요)**
  ```javascript
  async function handleGameExit(event) {
      event.preventDefault();

      if (gameState === 'playing' && confirm('게임을 종료하시겠습니까?\n현재 점수가 통합 포인트에 저장됩니다.')) {
          gameState = 'exiting';

          // 점수 저장
          if (window.addGamePoints) {
              await window.addGamePoints(score, '게임파일명.html');
          }
          await updatePointsDisplay();

          document.getElementById('gameContainer').classList.add('hidden');
          document.getElementById('menuScreen').classList.remove('hidden');
          gameState = 'menu';
      }
  }
  ```

- [ ] 14. **게임오버 처리**
  ```javascript
  async function gameOver() {
      gameState = 'gameover';

      // 최고 점수 업데이트
      if (score > highScore) {
          highScore = score;
          localStorage.setItem('게임파일명_highScore', highScore);
      }

      // 점수 저장 및 표시
      let totalPoints = 0;
      if (window.addGamePoints) {
          const result = await window.addGamePoints(score, '게임파일명.html');
          totalPoints = result?.newTotal || 0;
      }
      await updatePointsDisplay();

      // 게임오버 화면에 점수 표시
      document.getElementById('finalScore').textContent = score;
      document.getElementById('totalPoints').textContent = totalPoints;
      document.getElementById('highScore').textContent = highScore;

      // 화면 전환
      document.getElementById('gameContainer').classList.add('hidden');
      document.getElementById('gameoverScreen').classList.remove('hidden');
  }
  ```

### Phase 5: 통합 및 테스트

- [ ] 15. **초기화 코드 추가 (⚠️ 필수)**
  ```javascript
  window.addEventListener('load', async () => {
      // ⚠️ 중요: Supabase 초기화 대기 (포인트 표시를 위해 필수)
      if (window.waitForSupabaseInit) {
          await window.waitForSupabaseInit();
      }

      await updatePointsDisplay();

      // 조회수 증가 (중요!)
      if (window.incrementGameView) {
          await window.incrementGameView('게임파일명.html');
      }
  });
  ```
  - **`waitForSupabaseInit()` 호출 필수**: Supabase 초기화가 완료될 때까지 대기
    - 이 함수를 호출하지 않으면 `menuPoints`가 항상 0으로 표시됨
  - 게임 파일이 로드될 때마다 자동으로 조회수 증가
  - index.html 게임 카드 클릭 시에도 카운트됨

- [ ] 16. **Supabase games 테이블에 게임 추가**
  ```sql
  INSERT INTO public.games (game_url, release_date)
  VALUES ('게임파일명.html', '2025-XX-XX')
  ON CONFLICT (game_url) DO NOTHING;
  ```

- [ ] 17. **index.html에 게임 카드 추가**
  ```html
  <a href="게임파일명.html" class="game-card">
      <h3><span class="game-icon">🎯</span> 게임 이름</h3>
      <p>게임 설명</p>
      <span class="badge new">NEW</span>
  </a>
  ```

- [ ] 18. **games.json에 다국어 정보 추가**
  ```json
  {
      "name": {
          "ko": "게임 이름",
          "en": "Game Name",
          "zh-CN": "游戏名称",
          "es": "Nombre del Juego",
          "pt": "Nome do Jogo"
      },
      "url": "게임파일명.html",
      "icon": "🎯",
      "description": { ... },
      "category": "arcade",
      "releaseDate": "2025-XX-XX"
  }
  ```

- [ ] 19. **로컬 서버 재시작**
  ```bash
  # 기존 서버 종료
  taskkill //F //PID [PID번호]

  # 새로 시작
  python -m http.server 8000
  ```

- [ ] 20. **브라우저 테스트**
  - 강력 새로고침: `Ctrl + F5`
  - 개발자 도구 열기: `F12`
  - Console 탭에서 에러 확인

### Phase 6: 버그 수정 (자주 발생하는 것들)

- [ ] 21. **null 체크 추가**
  - 배열 접근 시: `if (array.length > 0 && array[0])`
  - 객체 접근 시: `if (obj && obj.property)`
  - DOM 요소: `if (element) { ... }`

- [ ] 22. **gameState 체크**
  - 모든 이벤트 핸들러에서 `if (gameState !== 'playing') return;`

- [ ] 23. **점수 표시 업데이트**
  ```javascript
  function updateGame() {
      // 게임 로직...

      // UI 업데이트
      const scoreEl = document.getElementById('score');
      if (scoreEl) scoreEl.textContent = score;
  }
  ```

---

## 자주 발생하는 오류 및 해결 방법 (실전 경험 기반)

### 1. Supabase 관련 오류

#### 오류: `Cannot read properties of undefined (reading 'createClient')`
```
TypeError: Cannot read properties of undefined (reading 'createClient')
at supabaseClient.js:9
```

**원인**: Supabase CDN 라이브러리가 로드되지 않음
**해결방법**: HTML `<head>`에 Supabase CDN 스크립트를 `supabaseClient.js` **이전에** 추가

```html
<!-- ❌ 잘못된 순서 -->
<script src="js/supabaseClient.js"></script>

<!-- ✅ 올바른 순서 -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/supabaseClient.js"></script>
```

#### 오류: `_supabaseClient is not defined`
```
ReferenceError: _supabaseClient is not defined
```

**원인**: `_supabaseClient` 변수를 직접 사용하려고 시도
**해결방법**: `js/supabaseClient.js`에서 제공하는 **window 전역 함수**를 사용

```javascript
// ❌ 잘못된 방법
const { data: { user } } = await _supabaseClient.auth.getUser();

// ✅ 올바른 방법
const points = window.getCurrentPoints ? window.getCurrentPoints() : 0;
if (window.addGamePoints) {
    await window.addGamePoints(score, 'game.html');
}
```

#### 오류: `Cannot access 'currentProfile' before initialization`
```
ReferenceError: Cannot access 'currentProfile' before initialization
```

**원인**: `supabaseClient.js`의 비동기 초기화가 완료되기 전에 `getCurrentPoints()` 호출
**해결방법**: **반드시 `waitForSupabaseInit()` 호출 후 포인트 표시**

```javascript
// ❌ 잘못된 방법 (초기화 대기 없이 바로 호출)
window.addEventListener('load', async () => {
    await updatePointsDisplay();  // menuPoints가 0으로 표시됨
});

// ✅ 올바른 방법 (초기화 완료 대기)
window.addEventListener('load', async () => {
    // ⚠️ 중요: Supabase 초기화 대기
    if (window.waitForSupabaseInit) {
        await window.waitForSupabaseInit();
    }

    await updatePointsDisplay();  // 실제 포인트가 표시됨

    // 조회수 증가
    if (window.incrementGameView) {
        await window.incrementGameView('게임파일명.html');
    }
});

async function updatePointsDisplay() {
    // 함수 존재 확인
    const points = window.getCurrentPoints ? window.getCurrentPoints() : 0;
    const menuPointsEl = document.getElementById('menuPoints');
    const gameoverPointsEl = document.getElementById('gameoverPoints');

    if (menuPointsEl) menuPointsEl.textContent = points;
    if (gameoverPointsEl) gameoverPointsEl.textContent = points;
}
```

**핵심 포인트**:
- `waitForSupabaseInit()`을 호출하지 않으면 `menuPoints`가 항상 0으로 표시됨
- `DOMContentLoaded`에서 Supabase가 비동기로 세션을 로드하므로 반드시 대기 필요

### 2. Null 참조 오류

#### 오류: `Cannot read properties of null (reading 'y')` (다트 게임 실제 케이스)
```
TypeError: Cannot read properties of null (reading 'y')
at updateGame (dart_game.html:639)
```

**원인**:
1. `dart` 객체가 null인데 `dart.y` 접근
2. 배열 요소가 null인데 속성 접근

**해결방법**:
```javascript
// ❌ 잘못된 방법 (다트 게임에서 실제 에러)
if (dart.y > canvas.height + 100) {
    // ...
}

// ✅ 올바른 방법
if (dart && (dart.y > canvas.height + 100 || dart.x < -100 || dart.x > canvas.width + 100)) {
    // ...
}

// ❌ 잘못된 방법 (궤적 그리기)
ctx.moveTo(dartTrail[0].x, dartTrail[0].y);

// ✅ 올바른 방법
if (dartTrail.length > 0 && dartTrail[0]) {
    ctx.moveTo(dartTrail[0].x, dartTrail[0].y);
    for (let i = 1; i < dartTrail.length; i++) {
        if (dartTrail[i]) {
            ctx.lineTo(dartTrail[i].x, dartTrail[i].y);
        }
    }
}
```

#### 오류: DOM 요소를 찾을 수 없음
```
TypeError: Cannot read properties of null (reading 'offsetHeight')
```

**원인**: DOM 요소가 존재하지 않거나 아직 로드되지 않음
**해결방법**: null 체크 후 접근

```javascript
function resizeCanvas() {
    const stats = document.querySelector('.stats');
    if (!stats) {
        console.warn('Stats element not found');
        return;
    }
    const statsHeight = stats.offsetHeight;
    // ...
}
```

### 3. 게임 로직 오류

#### 문제: 게임 루프가 멈춤
**원인**: `gameState`가 'playing'이 아님
**해결방법**:
- `startGame()`에서 `gameState = 'playing'` 확인
- 콘솔에서 `gameState` 값 디버깅

#### 문제: 터치/마우스 이벤트가 작동하지 않음
**원인**: `e.preventDefault()` 누락 또는 `gameState` 체크 오류
**해결방법**:
```javascript
canvas.addEventListener('touchstart', (e) => {
    e.preventDefault(); // 필수!
    if (gameState !== 'playing') return;
    // ...
});
```

### 4. 점수 시스템 오류

#### 문제: 점수가 저장되지 않음
**체크리스트**:
1. ✅ `window.addGamePoints()` 사용
2. ✅ 게임 URL이 정확한지 확인 (`'game_name.html'`)
3. ✅ Supabase `games` 테이블에 게임 URL 추가되었는지 확인
4. ✅ 함수 존재 여부 체크 (`if (window.addGamePoints)`)

```javascript
// ✅ 올바른 점수 저장
let totalPoints = 0;
if (window.addGamePoints) {
    const result = await window.addGamePoints(score, 'dart_game.html');
    totalPoints = result?.newTotal || 0;
}
```

### 5. 화면 전환 오류

#### 문제: 화면이 전환되지 않음
**원인**: `.hidden` 클래스 누락 또는 잘못된 사용
**해결방법**:
```javascript
// 메뉴 → 게임
document.getElementById('menuScreen').classList.add('hidden');
document.getElementById('gameContainer').classList.remove('hidden');

// 게임 → 게임오버
document.getElementById('gameContainer').classList.add('hidden');
document.getElementById('gameoverScreen').classList.remove('hidden');
```

### 6. 모바일 뷰포트 오류

#### 문제: 모바일에서 화면 높이가 이상함
**원인**: `--vh` CSS 변수 미적용
**해결방법**: viewport height fix 코드 추가

```javascript
function setViewportHeight() {
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
}

window.addEventListener('resize', setViewportHeight);
window.addEventListener('orientationchange', setViewportHeight);
setViewportHeight();
```

### 7. 디버깅 팁

#### 콘솔에서 확인할 것들
```javascript
// 1. Supabase 함수 확인
console.log('getCurrentPoints:', typeof window.getCurrentPoints);
console.log('addGamePoints:', typeof window.addGamePoints);

// 2. 현재 점수 확인
console.log('Current points:', window.getCurrentPoints ? window.getCurrentPoints() : 'not available');

// 3. 게임 상태 확인
console.log('Game state:', gameState);

// 4. 로그인 상태 확인
console.log('User:', window.currentUser);
console.log('Profile:', window.currentProfile);
```

#### 브라우저 개발자 도구 사용
1. **Console 탭**: 에러 메시지 확인
2. **Network 탭**: `supabaseClient.js` 로드 확인
3. **Elements 탭**: DOM 요소 존재 확인
4. **Application 탭**: localStorage 확인

---

## 실전 개발 경험 (다트 게임 케이스 스터디)

다트 게임 개발 중 실제로 발생했던 이슈와 해결 과정입니다.

### 발생한 문제들 (시간 순서대로)

1. **Supabase 클라이언트 에러** ✅ 해결
   ```
   ReferenceError: _supabaseClient is not defined
   ```
   - **원인**: `_supabaseClient` 변수를 직접 사용
   - **해결**: `window.getCurrentPoints()`, `window.addGamePoints()` 전역 함수 사용

2. **Temporal Dead Zone 에러** ✅ 해결
   ```
   ReferenceError: Cannot access 'currentProfile' before initialization
   ```
   - **원인**: `let` 변수 초기화 전 참조
   - **해결**: `supabaseClient.js`에서 `window.currentProfile` 사용

3. **Null 참조 에러 (dartTrail)** ✅ 해결
   ```
   TypeError: Cannot read properties of null (reading 'y')
   ```
   - **원인**: `dartTrail[0]`이 null
   - **해결**: `if (dartTrail.length > 0 && dartTrail[0])` 체크

4. **Supabase 라이브러리 로드 실패** ✅ 해결
   ```
   TypeError: Cannot read properties of undefined (reading 'createClient')
   ```
   - **원인**: Supabase CDN 스크립트 누락
   - **해결**: `<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>` 추가

5. **다트 객체 null 체크** ✅ 해결
   ```
   TypeError: Cannot read properties of null (reading 'y')
   at line 639
   ```
   - **원인**: `dart.y` 접근 시 dart가 null
   - **해결**: `if (dart && (dart.y > ...))` 체크

6. **로컬 서버 캐시 문제** ✅ 해결
   - **원인**: 브라우저가 이전 파일 캐시
   - **해결**: 서버 재시작 + `Ctrl + F5` 강력 새로고침

### 수정 커밋 기록

```bash
# 1차 수정: Supabase 통합 수정
git commit -m "Fix Supabase integration and null reference errors in dart game"

# 2차 수정: temporal dead zone 해결
git commit -m "Fix temporal dead zone error in supabaseClient.js"

# 3차 수정: 치명적 에러 해결
git commit -m "Fix critical errors in dart_game.html"

# 4차 수정: 가이드 업데이트
git commit -m "Update game creation guide with Supabase CDN requirement"

# 5차 수정: 트러블슈팅 가이드 추가
git commit -m "Add troubleshooting section to game creation guide"
```

### 배운 교훈

1. **Supabase 설정**
   - ✅ 항상 CDN 스크립트를 먼저 로드
   - ✅ `window.getCurrentPoints()` 전역 함수 사용
   - ✅ 함수 존재 여부 확인: `if (window.addGamePoints)`

2. **Null 안전성**
   - ✅ 모든 객체/배열 접근 전 null 체크
   - ✅ DOM 요소 접근 전 존재 확인
   - ✅ 조건문에서 복잡한 체크 시 괄호로 묶기

3. **개발 프로세스**
   - ✅ 단계별로 커밋 (기능별로 나누기)
   - ✅ 에러 발생 시 즉시 문서화
   - ✅ 로컬 서버 재시작 + 강력 새로고침

4. **디버깅 팁**
   - ✅ Console에서 함수 존재 확인
   - ✅ gameState 값 추적
   - ✅ null/undefined 구분

### 개발 시간

- **총 개발 시간**: 약 2시간
- **게임 로직 구현**: 30분
- **버그 수정**: 1시간
- **문서 작성**: 30분

### 체크리스트 (다음 게임에 적용)

개발 시작 전:
- [ ] Supabase CDN 스크립트 확인
- [ ] window 전역 함수 사용 확인
- [ ] null 체크 패턴 숙지

개발 중:
- [ ] 자주 테스트 (5분마다)
- [ ] Console 에러 즉시 확인
- [ ] 단계별 커밋

개발 완료 후:
- [ ] 모바일/PC 테스트
- [ ] 로그인/비로그인 테스트
- [ ] 점수 시스템 테스트
- [ ] 문서 업데이트

---

이 가이드를 따라 새로운 게임을 추가하면 일관된 사용자 경험과 코드 품질을 유지할 수 있습니다.

**다음 게임 개발 시 이 문서의 "개발 체크리스트" 섹션을 처음부터 따라가세요!**
