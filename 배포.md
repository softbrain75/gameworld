# 🚀 게임세상 배포 가이드

## 배포 환경

- **플랫폼**: Vercel
- **저장소**: https://github.com/softbrain75/gameworld
- **자동 배포**: GitHub main 브랜치에 푸시하면 Vercel이 자동으로 배포

## 배포 방법

### 1단계: 변경사항 커밋

```bash
# 변경된 파일 확인
git status

# 변경사항 스테이징
git add .

# 커밋 (한영 혼용 메시지)
git commit -m "$(cat <<'EOF'
English summary of changes

한글 상세 설명:
- 변경사항 1
- 변경사항 2

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

### 2단계: GitHub에 푸시

```bash
git push
```

### 3단계: Vercel 자동 배포 확인

1. https://vercel.com/dashboard 접속
2. 프로젝트 선택
3. **Deployments** 탭에서 진행 상황 확인
4. 1-2분 후 배포 완료

## Git 문제 해결

### "fatal: mmap failed: Invalid argument" 오류

Git 저장소가 손상된 경우:

```bash
# 1. Git config 수정
git config --global core.packedGitLimit 128m
git config --global core.packedGitWindowSize 128m
git config --global core.fscache false

# 2. Git index 재생성
rm -f .git/index
git reset

# 3. 여전히 안 되면: 임시 폴더에 클론 후 .git 폴더 교체
cd ..
git clone https://github.com/softbrain75/gameworld.git gameworld_temp
rm -rf "게임세상/.git"
cp -r gameworld_temp/.git "게임세상/.git"
rm -rf gameworld_temp
```

### Git 사용자 정보 설정

```bash
git config user.email "softbrain75@gmail.com"
git config user.name "softbrain75"
```

## Vercel 설정

### 환경 변수 (필요시)

Vercel Dashboard → 프로젝트 → Settings → Environment Variables

현재는 환경 변수 없이 작동 (Supabase 키가 코드에 포함됨)

### 빌드 설정

- **Framework Preset**: Other
- **Build Command**: (없음)
- **Output Directory**: (없음)
- **Install Command**: (없음)

정적 HTML 파일이므로 빌드 과정 불필요

## 배포 확인

### 1. 사이트 접속
배포된 Vercel URL로 접속 (예: https://gameworld.vercel.app)

### 2. 기능 테스트
- ✅ 게임 실행 확인
- ✅ 로그인/회원가입 작동 확인
- ✅ 포인트 시스템 작동 확인
- ✅ 조회수 기록 확인 (통계 페이지)

### 3. Supabase 연동 확인
- Supabase Dashboard에서 데이터 확인
- `profiles` 테이블: 사용자 포인트
- `game_views_anonymous` 테이블: 조회수

## 롤백 방법

문제 발생 시 이전 버전으로 롤백:

### Vercel에서 롤백
1. Vercel Dashboard → Deployments
2. 이전 배포 선택
3. **⋯** 메뉴 → **Promote to Production**

### Git에서 롤백
```bash
# 이전 커밋으로 되돌리기
git log  # 커밋 해시 확인
git revert <commit-hash>
git push
```

## 자주 발생하는 문제

### 1. 배포는 되었는데 변경사항이 안 보여요
**원인**: 브라우저 캐시
**해결**: Ctrl+Shift+R (강력 새로고침) 또는 시크릿 모드

### 2. Supabase 연동이 안 돼요
**원인**: CORS 설정 또는 RLS 정책
**해결**:
- Supabase Dashboard → Authentication → URL Configuration 확인
- Site URL에 Vercel 도메인 추가

### 3. 조회수가 안 올라가요
**원인**: `game_views_anonymous` 테이블 또는 `game_stats` 뷰 없음
**해결**: `supabase_schema.sql` 실행

### 4. 포인트가 안 쌓여요
**원인**: `profiles` 테이블 없음 또는 RLS 정책
**해결**: `SUPABASE_SETUP.md` 참조

## 배포 체크리스트

배포 전 확인사항:

- [ ] 로컬에서 테스트 완료
- [ ] Git 커밋 메시지 작성 (한영 혼용)
- [ ] Supabase 스키마 최신 상태 확인
- [ ] 민감한 정보(API 키 등) 노출 여부 확인
- [ ] 브라우저 콘솔 에러 없는지 확인

배포 후 확인사항:

- [ ] Vercel 배포 성공 확인
- [ ] 메인 페이지 로딩 확인
- [ ] 게임 실행 확인
- [ ] 로그인/회원가입 작동 확인
- [ ] 모바일 환경 테스트

## 추가 배포 옵션

### GitHub Pages (대안)

Vercel 대신 GitHub Pages 사용 가능:

1. GitHub 저장소 → Settings → Pages
2. Source: main 브랜치
3. Save
4. 배포 URL: https://softbrain75.github.io/gameworld/

**장점**: 무료, 간단
**단점**: 빌드 시간 느림, 환경 변수 지원 안 함

### Netlify (대안)

1. https://netlify.com 로그인
2. "Add new site" → "Import from Git"
3. GitHub 저장소 선택
4. Deploy

**장점**: Vercel과 유사, Form 기능 강력
**단점**: 빌드 시간 제한

## 참고 자료

- [Vercel 문서](https://vercel.com/docs)
- [Supabase 문서](https://supabase.com/docs)
- [CLAUDE.md](CLAUDE.md) - 프로젝트 구조 및 가이드라인
- [SUPABASE_SETUP.md](SUPABASE_SETUP.md) - Supabase 설정 가이드
