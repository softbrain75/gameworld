<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-fullscreen">
    <meta name="mobile-web-app-capable" content="yes">
    <title>ìœ·ë†€ì´ - Yut Nori</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            overflow: hidden;
            touch-action: none;
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        #gameCanvas {
            display: block;
            background: #2c1810;
            touch-action: none;
        }
        .screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
            padding: 20px;
            background: rgba(0,0,0,0.8);
            border-radius: 20px;
            max-width: 90%;
            width: 500px;
        }
        h1 {
            font-size: 48px;
            margin-bottom: 20px;
            color: #ffd700;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
        }
        .instructions {
            font-size: 18px;
            line-height: 1.6;
            margin: 20px 0;
            text-align: left;
        }
        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 24px;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }
        .button:active {
            transform: scale(0.95);
        }
        .highscore {
            font-size: 20px;
            margin: 15px 0;
            color: #ffd700;
        }
        #throwButton {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px 50px;
            font-size: 28px;
            z-index: 10;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }
        #gameInfo {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 20px;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            z-index: 5;
        }
        #turnInfo {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            font-size: 24px;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            z-index: 5;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="menuScreen" class="screen">
        <h1>ğŸ² ìœ·ë†€ì´</h1>
        <div class="instructions">
            <strong>ê²Œì„ ë°©ë²•:</strong><br>
            â€¢ ìœ·ì„ ë˜ì ¸ì„œ ë§ì„ ì´ë™ì‹œí‚¤ì„¸ìš”<br>
            â€¢ ë„(1ì¹¸), ê°œ(2ì¹¸), ê±¸(3ì¹¸), ìœ·(4ì¹¸), ëª¨(5ì¹¸)<br>
            â€¢ ìœ·ì´ë‚˜ ëª¨ê°€ ë‚˜ì˜¤ë©´ í•œ ë²ˆ ë” ë˜ì§€ê¸°!<br>
            â€¢ ëŒ€ê°ì„  ê¸¸ì„ í™œìš©í•˜ì„¸ìš”<br>
            â€¢ ìƒëŒ€ ë§ì„ ì¡ìœ¼ë©´ í•œ ë²ˆ ë”!<br>
            â€¢ ë¨¼ì € 4ê°œì˜ ë§ì„ ëª¨ë‘ ê³¨ì¸ì‹œí‚¤ë©´ ìŠ¹ë¦¬!<br><br>
            <strong>ì¡°ì‘:</strong><br>
            â€¢ 'ìœ· ë˜ì§€ê¸°' ë²„íŠ¼ìœ¼ë¡œ ìœ·ì„ ë˜ì§<br>
            â€¢ ë§ì„ í´ë¦­/íƒ­í•˜ì—¬ ì´ë™
        </div>
        <div class="highscore">ìµœê³  ê¸°ë¡: <span id="menuHighScore">0</span>í„´</div>
        <button class="button" onclick="startGame()">ê²Œì„ ì‹œì‘</button>
    </div>
    <div id="gameoverScreen" class="screen" style="display:none;">
        <h1>ğŸ‰ ê²Œì„ ì¢…ë£Œ!</h1>
        <div style="font-size: 32px; margin: 30px 0;">
            <div id="winner"></div>
            <div style="margin-top: 20px;">ì´ í„´ ìˆ˜: <span id="finalTurns">0</span></div>
        </div>
        <div class="highscore">ìµœê³  ê¸°ë¡: <span id="gameoverHighScore">0</span>í„´</div>
        <button class="button" onclick="startGame()">ë‹¤ì‹œ í•˜ê¸°</button>
        <button class="button" onclick="showMenu()">ë©”ë‰´ë¡œ</button>
    </div>
    <div id="gameInfo" style="display:none;">
        í„´: <span id="turnCount">0</span>
    </div>
    <div id="turnInfo" style="display:none;">
        <span id="currentPlayer">í”Œë ˆì´ì–´ 1</span>ì˜ ì°¨ë¡€
    </div>
    <button id="throwButton" class="button" style="display:none;" onclick="throwYut()">ìœ· ë˜ì§€ê¸°</button>

    <script>
        // Viewport height fix for mobile
        let vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
        window.addEventListener('resize', () => {
            vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        });

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let gameState = 'menu';
        let turnCount = 0;
        let currentPlayer = 1; // 1 or 2
        let yutResult = null;
        let extraTurn = false;
        let selectedPieceIndex = -1;

        // Audio
        let audioContext = null;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }

        function playSound(soundType) {
            try {
                initAudio();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                switch(soundType) {
                    case 'throw':
                        oscillator.frequency.value = 600;
                        gainNode.gain.value = 0.10;
                        oscillator.type = 'sine';
                        break;
                    case 'move':
                        oscillator.frequency.value = 440;
                        gainNode.gain.value = 0.08;
                        oscillator.type = 'sine';
                        break;
                    case 'capture':
                        oscillator.frequency.value = 800;
                        gainNode.gain.value = 0.12;
                        oscillator.type = 'sine';
                        break;
                    case 'win':
                        oscillator.frequency.value = 1000;
                        gainNode.gain.value = 0.15;
                        oscillator.type = 'sine';
                        break;
                }

                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {}
        }

        // Board positions (ìœ·ë†€ì´ íŒ ì¢Œí‘œ)
        const boardPositions = [];

        function initBoardPositions() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const size = Math.min(canvas.width, canvas.height) * 0.35;

            // ë°”ê¹¥ ê²½ë¡œ (20ê°œ ìœ„ì¹˜)
            // ì‹œì‘ì ë¶€í„° ì‹œê³„ë°©í–¥
            boardPositions[0] = { x: centerX - size, y: centerY, type: 'start' }; // ì‹œì‘

            // ì™¼ìª½ í•˜ë‹¨ (1-4)
            for (let i = 1; i <= 4; i++) {
                boardPositions[i] = { x: centerX - size, y: centerY + (size / 4) * i };
            }

            // í•˜ë‹¨ (5-9)
            boardPositions[5] = { x: centerX - size, y: centerY + size }; // ì½”ë„ˆ
            for (let i = 1; i <= 4; i++) {
                boardPositions[5 + i] = { x: centerX - size + (size / 4) * i, y: centerY + size };
            }

            // ì¤‘ì•™ í•˜ë‹¨ (10-14)
            boardPositions[10] = { x: centerX, y: centerY + size }; // ì½”ë„ˆ
            for (let i = 1; i <= 4; i++) {
                boardPositions[10 + i] = { x: centerX + (size / 4) * i, y: centerY + size };
            }

            // ìš°ì¸¡ í•˜ë‹¨ (15-19)
            boardPositions[15] = { x: centerX + size, y: centerY + size }; // ì½”ë„ˆ
            for (let i = 1; i <= 4; i++) {
                boardPositions[15 + i] = { x: centerX + size, y: centerY + size - (size / 4) * i };
            }

            // ìš°ì¸¡ ìƒë‹¨ (20-24)
            boardPositions[20] = { x: centerX + size, y: centerY }; // ì½”ë„ˆ
            for (let i = 1; i <= 4; i++) {
                boardPositions[20 + i] = { x: centerX + size, y: centerY - (size / 4) * i };
            }

            // ìƒë‹¨ (25-29)
            boardPositions[25] = { x: centerX + size, y: centerY - size }; // ì½”ë„ˆ
            for (let i = 1; i <= 4; i++) {
                boardPositions[25 + i] = { x: centerX + size - (size / 4) * i, y: centerY - size };
            }

            // ì¤‘ì•™ ìƒë‹¨ (30-34)
            boardPositions[30] = { x: centerX, y: centerY - size }; // ì½”ë„ˆ
            for (let i = 1; i <= 4; i++) {
                boardPositions[30 + i] = { x: centerX - (size / 4) * i, y: centerY - size };
            }

            // ì¢Œì¸¡ ìƒë‹¨ (35-39)
            boardPositions[35] = { x: centerX - size, y: centerY - size }; // ì½”ë„ˆ
            for (let i = 1; i <= 3; i++) {
                boardPositions[35 + i] = { x: centerX - size, y: centerY - size + (size / 4) * i };
            }
            boardPositions[39] = { x: centerX - size, y: centerY }; // ì‹œì‘ì  ë³µê·€

            // ì¤‘ì•™ì  (40)
            boardPositions[40] = { x: centerX, y: centerY, type: 'center' };

            // ëŒ€ê°ì„  ê²½ë¡œ ì¶”ê°€
            // ì¢Œí•˜ë‹¨ â†’ ì¤‘ì•™ (5, 41-44, 40)
            for (let i = 1; i <= 4; i++) {
                const t = i / 5;
                boardPositions[40 + i] = {
                    x: centerX - size + size * t,
                    y: centerY + size - size * t
                };
            }

            // ìš°í•˜ë‹¨ â†’ ì¤‘ì•™ (15, 45-48, 40)
            for (let i = 1; i <= 4; i++) {
                const t = i / 5;
                boardPositions[44 + i] = {
                    x: centerX + size - size * t,
                    y: centerY + size - size * t
                };
            }

            // ì¤‘ì•™ ìƒë‹¨ â†’ ì¤‘ì•™ (30, 49-52, 40)
            for (let i = 1; i <= 4; i++) {
                const t = i / 5;
                boardPositions[48 + i] = {
                    x: centerX,
                    y: centerY - size + size * t
                };
            }
        }

        // Player pieces
        const players = {
            1: {
                pieces: [
                    { position: -1, path: 'outer' }, // -1 = ì‹œì‘ ì „
                    { position: -1, path: 'outer' },
                    { position: -1, path: 'outer' },
                    { position: -1, path: 'outer' }
                ],
                color: '#ff6b6b',
                finished: 0
            },
            2: {
                pieces: [
                    { position: -1, path: 'outer' },
                    { position: -1, path: 'outer' },
                    { position: -1, path: 'outer' },
                    { position: -1, path: 'outer' }
                ],
                color: '#4ecdc4',
                finished: 0
            }
        };

        function startGame() {
            gameState = 'playing';
            turnCount = 0;
            currentPlayer = 1;
            yutResult = null;
            extraTurn = false;
            selectedPieceIndex = -1;

            // Reset players
            players[1].pieces = [
                { position: -1, path: 'outer' },
                { position: -1, path: 'outer' },
                { position: -1, path: 'outer' },
                { position: -1, path: 'outer' }
            ];
            players[1].finished = 0;

            players[2].pieces = [
                { position: -1, path: 'outer' },
                { position: -1, path: 'outer' },
                { position: -1, path: 'outer' },
                { position: -1, path: 'outer' }
            ];
            players[2].finished = 0;

            initBoardPositions();

            document.getElementById('menuScreen').style.display = 'none';
            document.getElementById('gameoverScreen').style.display = 'none';
            document.getElementById('gameInfo').style.display = 'block';
            document.getElementById('turnInfo').style.display = 'block';
            document.getElementById('throwButton').style.display = 'block';

            updateTurnDisplay();
        }

        function showMenu() {
            gameState = 'menu';
            document.getElementById('menuScreen').style.display = 'block';
            document.getElementById('gameoverScreen').style.display = 'none';
            document.getElementById('gameInfo').style.display = 'none';
            document.getElementById('turnInfo').style.display = 'none';
            document.getElementById('throwButton').style.display = 'none';
            updateHighScore();
        }

        function throwYut() {
            if (gameState !== 'playing' || yutResult !== null) return;

            playSound('throw');

            // ìœ· ê²°ê³¼: ë„(1), ê°œ(2), ê±¸(3), ìœ·(4), ëª¨(5)
            const rand = Math.random();
            if (rand < 0.2) yutResult = { name: 'ë„', value: 1, extra: false };
            else if (rand < 0.4) yutResult = { name: 'ê°œ', value: 2, extra: false };
            else if (rand < 0.6) yutResult = { name: 'ê±¸', value: 3, extra: false };
            else if (rand < 0.85) yutResult = { name: 'ìœ·', value: 4, extra: true };
            else yutResult = { name: 'ëª¨', value: 5, extra: true };

            document.getElementById('throwButton').textContent = `${yutResult.name} (${yutResult.value}ì¹¸)`;
            document.getElementById('throwButton').disabled = true;
        }

        function updateTurnDisplay() {
            document.getElementById('turnCount').textContent = turnCount;
            document.getElementById('currentPlayer').textContent = `í”Œë ˆì´ì–´ ${currentPlayer}`;
            document.getElementById('currentPlayer').style.color = players[currentPlayer].color;
        }

        function nextTurn() {
            if (!extraTurn) {
                currentPlayer = currentPlayer === 1 ? 2 : 1;
                turnCount++;
            }
            extraTurn = false;
            yutResult = null;
            selectedPieceIndex = -1;
            document.getElementById('throwButton').textContent = 'ìœ· ë˜ì§€ê¸°';
            document.getElementById('throwButton').disabled = false;
            updateTurnDisplay();
        }

        function movePiece(pieceIndex) {
            if (yutResult === null || selectedPieceIndex !== -1) return;

            const piece = players[currentPlayer].pieces[pieceIndex];

            // ì´ë¯¸ ê³¨ì¸í•œ ë§ì€ ì„ íƒ ë¶ˆê°€
            if (piece.position === 999) return;

            playSound('move');
            selectedPieceIndex = pieceIndex;

            // ì‹œì‘ ì „ ë§
            if (piece.position === -1) {
                piece.position = 0;
                piece.path = 'outer';
            }

            // ì´ë™ ë¡œì§
            let newPos = piece.position + yutResult.value;

            // íŠ¹ì • ìœ„ì¹˜ì—ì„œ ëŒ€ê°ì„ ìœ¼ë¡œ ì „í™˜ ê°€ëŠ¥
            if (piece.path === 'outer') {
                if (piece.position === 5 && newPos > 5) {
                    // ì¢Œí•˜ë‹¨ ëŒ€ê°ì„ ìœ¼ë¡œ
                    piece.path = 'diag1';
                    newPos = 41 + (newPos - 5 - 1);
                } else if (piece.position === 10 && newPos > 10) {
                    // ì¤‘ì•™ í•˜ë‹¨ì—ì„œ ëŒ€ê°ì„  (ë°”ë¡œ ì•)
                    piece.path = 'diag2';
                    newPos = 45 + (newPos - 10 - 1);
                } else if (piece.position === 30 && newPos > 30) {
                    // ì¤‘ì•™ ìƒë‹¨ì—ì„œ ëŒ€ê°ì„ 
                    piece.path = 'diag3';
                    newPos = 49 + (newPos - 30 - 1);
                }
            }

            // ê³¨ì¸ ì²´í¬
            if (piece.path === 'outer' && newPos >= 39) {
                piece.position = 999; // ê³¨ì¸
                players[currentPlayer].finished++;

                if (players[currentPlayer].finished >= 4) {
                    gameOver();
                    return;
                }
            } else if (piece.path === 'diag1' && newPos >= 44) {
                piece.position = 999;
                players[currentPlayer].finished++;

                if (players[currentPlayer].finished >= 4) {
                    gameOver();
                    return;
                }
            } else if (piece.path === 'diag2' && newPos >= 48) {
                piece.position = 999;
                players[currentPlayer].finished++;

                if (players[currentPlayer].finished >= 4) {
                    gameOver();
                    return;
                }
            } else if (piece.path === 'diag3' && newPos >= 52) {
                piece.position = 999;
                players[currentPlayer].finished++;

                if (players[currentPlayer].finished >= 4) {
                    gameOver();
                    return;
                }
            } else {
                piece.position = newPos;

                // ìƒëŒ€ ë§ ì¡ê¸° ì²´í¬
                const opponent = currentPlayer === 1 ? 2 : 1;
                for (let i = 0; i < 4; i++) {
                    const oppPiece = players[opponent].pieces[i];
                    if (oppPiece.position === piece.position && oppPiece.path === piece.path) {
                        oppPiece.position = -1;
                        playSound('capture');
                        extraTurn = true;
                    }
                }
            }

            // ìœ·ì´ë‚˜ ëª¨ë©´ í•œ ë²ˆ ë”
            if (yutResult.extra) {
                extraTurn = true;
            }

            setTimeout(() => {
                nextTurn();
            }, 300);
        }

        function gameOver() {
            gameState = 'gameover';
            playSound('win');

            document.getElementById('winner').textContent = `í”Œë ˆì´ì–´ ${currentPlayer} ìŠ¹ë¦¬!`;
            document.getElementById('winner').style.color = players[currentPlayer].color;
            document.getElementById('finalTurns').textContent = turnCount;

            // High score (ìµœì†Œ í„´ ìˆ˜)
            const currentHighScore = localStorage.getItem('yutNori_highScore');
            if (!currentHighScore || turnCount < parseInt(currentHighScore)) {
                localStorage.setItem('yutNori_highScore', turnCount);
            }

            updateHighScore();

            document.getElementById('gameoverScreen').style.display = 'block';
            document.getElementById('gameInfo').style.display = 'none';
            document.getElementById('turnInfo').style.display = 'none';
            document.getElementById('throwButton').style.display = 'none';
        }

        function updateHighScore() {
            const highScore = localStorage.getItem('yutNori_highScore') || 'ì—†ìŒ';
            document.getElementById('menuHighScore').textContent = highScore;
            document.getElementById('gameoverHighScore').textContent = highScore;
        }

        // Canvas interaction
        canvas.addEventListener('click', (e) => {
            if (gameState !== 'playing' || yutResult === null) return;

            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // ë§ ì„ íƒ
            for (let i = 0; i < 4; i++) {
                const piece = players[currentPlayer].pieces[i];
                if (piece.position === 999) continue;

                let px, py;
                if (piece.position === -1) {
                    // ì‹œì‘ ëŒ€ê¸° ìœ„ì¹˜
                    px = 50 + i * 60;
                    py = currentPlayer === 1 ? canvas.height - 80 : 80;
                } else {
                    const pos = getBoardPosition(piece);
                    px = pos.x;
                    py = pos.y;
                }

                const dist = Math.sqrt((x - px) ** 2 + (y - py) ** 2);
                if (dist < 25) {
                    movePiece(i);
                    break;
                }
            }
        });

        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (gameState !== 'playing' || yutResult === null) return;

            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;

            for (let i = 0; i < 4; i++) {
                const piece = players[currentPlayer].pieces[i];
                if (piece.position === 999) continue;

                let px, py;
                if (piece.position === -1) {
                    px = 50 + i * 60;
                    py = currentPlayer === 1 ? canvas.height - 80 : 80;
                } else {
                    const pos = getBoardPosition(piece);
                    px = pos.x;
                    py = pos.y;
                }

                const dist = Math.sqrt((x - px) ** 2 + (y - py) ** 2);
                if (dist < 25) {
                    movePiece(i);
                    break;
                }
            }
        });

        function getBoardPosition(piece) {
            if (piece.path === 'outer') {
                return boardPositions[piece.position];
            } else if (piece.path === 'diag1') {
                return boardPositions[piece.position];
            } else if (piece.path === 'diag2') {
                return boardPositions[piece.position];
            } else if (piece.path === 'diag3') {
                return boardPositions[piece.position];
            }
            return boardPositions[0];
        }

        // Draw functions
        function drawBoard() {
            ctx.strokeStyle = '#8b6f47';
            ctx.lineWidth = 3;

            // ë°”ê¹¥ ì‚¬ê°í˜•
            ctx.beginPath();
            ctx.moveTo(boardPositions[0].x, boardPositions[0].y);
            ctx.lineTo(boardPositions[5].x, boardPositions[5].y);
            ctx.lineTo(boardPositions[10].x, boardPositions[10].y);
            ctx.lineTo(boardPositions[15].x, boardPositions[15].y);
            ctx.lineTo(boardPositions[20].x, boardPositions[20].y);
            ctx.lineTo(boardPositions[25].x, boardPositions[25].y);
            ctx.lineTo(boardPositions[30].x, boardPositions[30].y);
            ctx.lineTo(boardPositions[35].x, boardPositions[35].y);
            ctx.closePath();
            ctx.stroke();

            // ëŒ€ê°ì„ ë“¤
            ctx.beginPath();
            ctx.moveTo(boardPositions[5].x, boardPositions[5].y);
            ctx.lineTo(boardPositions[40].x, boardPositions[40].y);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(boardPositions[15].x, boardPositions[15].y);
            ctx.lineTo(boardPositions[40].x, boardPositions[40].y);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(boardPositions[30].x, boardPositions[30].y);
            ctx.lineTo(boardPositions[40].x, boardPositions[40].y);
            ctx.stroke();

            // ìœ„ì¹˜ ì  ê·¸ë¦¬ê¸°
            for (let i = 0; i <= 39; i++) {
                if (!boardPositions[i]) continue;

                ctx.fillStyle = (i === 0 || i === 5 || i === 10 || i === 15 || i === 20 || i === 25 || i === 30 || i === 35) ? '#ffd700' : '#8b6f47';
                ctx.beginPath();
                ctx.arc(boardPositions[i].x, boardPositions[i].y, 8, 0, Math.PI * 2);
                ctx.fill();
            }

            // ì¤‘ì•™ì 
            ctx.fillStyle = '#ffd700';
            ctx.beginPath();
            ctx.arc(boardPositions[40].x, boardPositions[40].y, 12, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawPieces() {
            // Player 1 pieces
            for (let i = 0; i < 4; i++) {
                const piece = players[1].pieces[i];
                if (piece.position === 999) continue;

                let x, y;
                if (piece.position === -1) {
                    x = 50 + i * 60;
                    y = canvas.height - 80;
                } else {
                    const pos = getBoardPosition(piece);
                    x = pos.x;
                    y = pos.y;
                }

                ctx.fillStyle = players[1].color;
                ctx.strokeStyle = currentPlayer === 1 && yutResult !== null ? '#fff' : '#000';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(x, y, 20, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();

                ctx.fillStyle = '#fff';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('1', x, y);
            }

            // Player 2 pieces
            for (let i = 0; i < 4; i++) {
                const piece = players[2].pieces[i];
                if (piece.position === 999) continue;

                let x, y;
                if (piece.position === -1) {
                    x = 50 + i * 60;
                    y = 80;
                } else {
                    const pos = getBoardPosition(piece);
                    x = pos.x;
                    y = pos.y;
                }

                ctx.fillStyle = players[2].color;
                ctx.strokeStyle = currentPlayer === 2 && yutResult !== null ? '#fff' : '#000';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(x, y, 20, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();

                ctx.fillStyle = '#fff';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('2', x, y);
            }
        }

        function gameLoop() {
            if (gameState === 'playing') {
                ctx.fillStyle = '#2c1810';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                drawBoard();
                drawPieces();
            }

            requestAnimationFrame(gameLoop);
        }

        // Initialize
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (gameState === 'playing') {
                initBoardPositions();
            }
        });

        updateHighScore();
        gameLoop();
    </script>
</body>
</html>