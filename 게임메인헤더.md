# κ²μ„ λ©”μΈ ν—¤λ” κµ¬μ΅° κ°€μ΄λ“

μ΄ λ¬Έμ„λ” κ²μ„ ν”λ μ΄ μ¤‘ ν™”λ©΄μ ν—¤λ”(ν†µκ³„ λ°”) κµ¬μ΅°λ¥Ό μ •μν•©λ‹λ‹¤.

## 1. κΈ°λ³Έ HTML κµ¬μ΅°

### Game Container & Stats Header
```html
<div id="gameContainer" class="game-container hidden">
    <div class="stats">
        <a href="#" class="back-btn-game" onclick="handleGameExit(event)">
            <span class="material-icons">arrow_back</span>
        </a>
        <div class="stat-item">
            <div class="stat-label">Score</div>
            <div class="stat-value" id="score">0</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">Shields</div>
            <div class="stat-value" id="shields">100</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">Kills</div>
            <div class="stat-value" id="kills">0</div>
        </div>
    </div>
    <canvas id="gameCanvas"></canvas>
</div>
```

---

## 2. CSS μ¤νƒ€μΌ

### Stats Header (ν†µκ³„ λ°”)
```css
.stats {
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 10px;
    background: rgba(0, 0, 0, 0.9);
    color: white;
    font-size: 1em;
    border-bottom: 2px solid rgba(255, 204, 0, 0.5);
    gap: 8px;
}
```

**ν•µμ‹¬ ν¬μΈνΈ:**
- `display: flex` - κ°€λ΅ λ°°μΉ
- `align-items: center` - μ„Έλ΅ μ¤‘μ•™ μ •λ ¬
- `gap: 8px` - μ”μ† κ°„ κ°„κ²©
- `justify-content: space-around` - μ”μ†λ“¤ κ· λ“± λ°°μΉ

### Back Button (μ΄μ „ λ²„νΌ)
```css
.back-btn-game {
    background: transparent;
    border: none;
    color: #ffcc00;  /* κ²μ„ ν…λ§ μƒ‰μƒ */
    cursor: pointer;
    padding: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    border-radius: 50%;
    transition: background 0.2s ease;
    width: 36px;
    height: 36px;
    flex-shrink: 0;  /* μ¤‘μ”: λ²„νΌ ν¬κΈ° κ³ μ • */
}

.back-btn-game .material-icons {
    font-size: 24px;
}

.back-btn-game:hover {
    background: rgba(255, 204, 0, 0.1);
}

.back-btn-game:active {
    background: rgba(255, 204, 0, 0.2);
}
```

**ν•µμ‹¬ ν¬μΈνΈ:**
- `flex-shrink: 0` - ν™”λ©΄μ΄ μΆμ•„μ Έλ„ λ²„νΌ ν¬κΈ° μ μ§€
- `border-radius: 50%` - μ›ν• λ²„νΌ
- Material Icons μ‚¬μ©
- κ²μ„ ν…λ§μ— λ§λ” μƒ‰μƒ μ‚¬μ©

### Stat Item (ν†µκ³„ ν•­λ©)
```css
.stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.stat-label {
    font-size: 0.7em;
    opacity: 0.8;
    color: #ffcc00;  /* κ²μ„ ν…λ§ μƒ‰μƒ */
    text-transform: uppercase;
}

.stat-value {
    font-size: 1.4em;
    font-weight: bold;
}
```

**ν•µμ‹¬ ν¬μΈνΈ:**
- λΌλ²¨ μ„, κ°’ μ•„λλ΅ μ„Έλ΅ λ°°μΉ
- λΌλ²¨μ€ μ‘κ², κ°’μ€ ν¬κ³  bold
- λΌλ²¨ μƒ‰μƒμΌλ΅ ν…λ§ ν‘ν„

---

## 3. JavaScript λ΅μ§

### μ μ μ‹μ¤ν… (λ€ν¬ λ””νλ” λ°©μ‹)

#### λ³€μ μ„ μ–Έ
```javascript
// Game state
let gameState = 'menu';
let score = 0; // μ΄λ² ν μ μ (κ²μ„ μ‹μ‘ μ‹ 0λ¶€ν„°)
let shields = 100;
let kills = 0;
let highScore = localStorage.getItem('xwing_highScore') || 0;
```

**ν•µμ‹¬ κ°λ…:**
- **score**: μ΄λ² ν μ μ (λ§¤ κ²μ„λ§λ‹¤ 0λ¶€ν„° μ‹μ‘)
- **ν†µν•© ν¬μΈνΈ**: Supabaseμ— λ„μ λλ” μ΄ ν¬μΈνΈ (getCurrentPoints()λ΅ κ°€μ Έμ΄)

#### κ²μ„ μ‹μ‘
```javascript
window.startGame = async function() {
    document.getElementById('menuScreen').classList.add('hidden');
    document.getElementById('gameoverScreen').classList.add('hidden');
    document.getElementById('gameContainer').classList.remove('hidden');

    gameState = 'playing';
    score = 0; // μ΄λ² ν μ μλ” 0λ¶€ν„° μ‹μ‘
    shields = 100;
    kills = 0;
    // ... κΈ°νƒ€ μ΄κΈ°ν™”

    updateUI();
};
```

**ν•µμ‹¬ ν¬μΈνΈ:**
- `score = 0` - ν•­μƒ 0λ¶€ν„° μ‹μ‘
- ν†µν•© ν¬μΈνΈλ” κ±΄λ“λ¦¬μ§€ μ•μ

#### UI μ—…λ°μ΄νΈ
```javascript
function updateUI() {
    document.getElementById('score').textContent = score.toLocaleString();
    document.getElementById('shields').textContent = shields;
    document.getElementById('kills').textContent = kills;
}
```

#### κ²μ„ μΆ…λ£ (μ •μƒ μΆ…λ£)
```javascript
async function endGame() {
    gameState = 'gameover';

    // Stop background music
    stopBackgroundMusic();

    const avgScore = kills > 0 ? Math.round(score / kills) : 0;

    // κ²μ„ μΆ…λ£ μ‹ μ΄λ² ν μ μλ¥Ό ν†µν•© ν¬μΈνΈμ— μ λ¦½
    await addGamePoints(score, 'xwing');

    // ν†µν•© ν¬μΈνΈ κ°€μ Έμ¤κΈ°
    const totalPoints = getCurrentPoints();

    // ν™”λ©΄ ν‘μ‹
    document.getElementById('finalScore').textContent = score.toLocaleString();
    document.getElementById('totalPoints').textContent = totalPoints.toLocaleString();
    document.getElementById('gameoverPoints').textContent = totalPoints.toLocaleString();
    document.getElementById('killCount').textContent = kills;
    document.getElementById('avgScore').textContent = avgScore;

    // μµκ³  κΈ°λ΅ μ²΄ν¬
    const isNewRecord = score > highScore;
    if (isNewRecord) {
        highScore = score;
        localStorage.setItem('xwing_highScore', highScore);
        document.getElementById('newRecord').classList.remove('hidden');
    }

    document.getElementById('gameoverScreen').classList.remove('hidden');
}
```

**ν•µμ‹¬ ν¬μΈνΈ:**
1. `await addGamePoints(score, 'xwing')` - μ΄λ² ν μ μλ¥Ό ν†µν•© ν¬μΈνΈμ— **λ”ν•κΈ°**
2. `getCurrentPoints()` - μ—…λ°μ΄νΈλ ν†µν•© ν¬μΈνΈ κ°€μ Έμ¤κΈ°
3. λ‘ μ μλ¥Ό λ¨λ‘ ν™”λ©΄μ— ν‘μ‹

#### κ²μ„ λ‚κ°€κΈ° (μ΄μ „ λ²„νΌ)
```javascript
async function handleGameExit(event) {
    event.preventDefault();

    if (gameState === 'playing' && confirm('κ²μ„μ„ μΆ…λ£ν•μ‹κ² μµλ‹κΉ?\nν„μ¬ μ μκ°€ ν†µν•© ν¬μΈνΈμ— μ €μ¥λ©λ‹λ‹¤.')) {
        gameState = 'exiting';

        // μμ•… μ •μ§€
        stopBackgroundMusic();

        // ν„μ¬ μ μλ¥Ό ν†µν•© ν¬μΈνΈμ— μ €μ¥
        await addGamePoints(score, 'xwing');

        // ν¬μΈνΈ ν‘μ‹ μ—…λ°μ΄νΈ
        updatePointsDisplay();

        // λ©”λ‰΄λ΅ λμ•„κ°€κΈ°
        document.getElementById('gameContainer').classList.add('hidden');
        document.getElementById('menuScreen').classList.remove('hidden');

        gameState = 'menu';
    }
}
```

**ν•µμ‹¬ ν¬μΈνΈ:**
1. `event.preventDefault()` - λ§ν¬ κΈ°λ³Έ λ™μ‘ λ°©μ§€
2. `confirm()` - μ‚¬μ©μ ν™•μΈ
3. `await addGamePoints(score, 'xwing')` - μ μ μ €μ¥
4. `updatePointsDisplay()` - λ©”λ‰΄ ν™”λ©΄ ν¬μΈνΈ ν‘μ‹ μ—…λ°μ΄νΈ
5. ν™”λ©΄ μ „ν™

---

## 4. Game Over ν™”λ©΄ μ μ ν‘μ‹

### HTML κµ¬μ΅°
```html
<div class="gameover-content">
    <div class="game-icon">π’¥</div>
    <h1>κ²©μ¶”λ¨!</h1>

    <!-- μ μ μ •λ³΄ -->
    <div class="score-info" style="background: rgba(255,204,0,0.1); padding: 15px; border-radius: 10px; margin: 15px 0;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span style="opacity: 0.8;">μ΄λ²ν μ μ</span>
            <span style="font-size: 1.3em; font-weight: bold; color: #ffcc00;" id="finalScore">0</span>
        </div>
        <div style="display: flex; justify-content: space-between;">
            <span style="opacity: 0.8;">ν†µν•© ν¬μΈνΈ</span>
            <span style="font-size: 1.3em; font-weight: bold; color: #00ff00;" id="totalPoints">0</span>
        </div>
    </div>

    <!-- κΈ°νƒ€ ν†µκ³„ -->
    <div class="stats-grid">
        <div class="stat-box">
            <div>κ²©μ¶”</div>
            <div id="killCount">0</div>
        </div>
        <div class="stat-box">
            <div>ν‰κ·  μ μ</div>
            <div id="avgScore">0</div>
        </div>
    </div>

    <button class="btn" onclick="startGame()">π”„ μ¬μ¶κ²©</button>
</div>
```

**ν•µμ‹¬ ν¬μΈνΈ:**
- **μ΄λ²ν μ μ**: μ΄λ² κ²μ„μ—μ„λ§ μ–»μ€ μ μ (λ…Έλ€μƒ‰)
- **ν†µν•© ν¬μΈνΈ**: λ„μ λ μ΄ ν¬μΈνΈ (μ΄λ΅μƒ‰)
- `display: flex` + `justify-content: space-between` μΌλ΅ λΌλ²¨κ³Ό κ°’ μΆμ° λ°°μΉ

---

## 5. Supabase ν†µν•©

### ν•„μ”ν• ν•¨μλ“¤
```javascript
// supabaseClient.jsμ—μ„ μ κ³µν•λ” ν•¨μλ“¤

// ν„μ¬ ν†µν•© ν¬μΈνΈ κ°€μ Έμ¤κΈ°
getCurrentPoints()

// κ²μ„ μ μλ¥Ό ν†µν•© ν¬μΈνΈμ— μ¶”κ°€
await addGamePoints(gameScore, gameId)
// μ: await addGamePoints(score, 'xwing')

// ν¬μΈνΈ ν‘μ‹ μ—…λ°μ΄νΈ
updatePointsDisplay()
```

### ν¬μΈνΈ ν‘μ‹ μ—…λ°μ΄νΈ ν•¨μ
```javascript
function updatePointsDisplay() {
    const points = getCurrentPoints();
    const menuPointsEl = document.getElementById('menuPoints');
    const gameoverPointsEl = document.getElementById('gameoverPoints');

    if (menuPointsEl) menuPointsEl.textContent = points;
    if (gameoverPointsEl) gameoverPointsEl.textContent = points;
}

// νμ΄μ§€ λ΅λ“ μ‹
window.addEventListener('DOMContentLoaded', async () => {
    await getCurrentSession();
    updatePointsDisplay();
});

// λ΅κ·ΈμΈ/λ΅κ·Έμ•„μ›ƒ μ‹
window.addEventListener('userSignedIn', updatePointsDisplay);
window.addEventListener('userSignedOut', updatePointsDisplay);
```

---

## 6. μ μ μ‹μ¤ν… νλ¦„

```
κ²μ„ μ‹μ‘
  β””β”€ score = 0 (μ΄λ² ν μ μ)
  β””β”€ ν†µν•© ν¬μΈνΈλ” κ·Έλ€λ΅ μ μ§€

κ²μ„ μ§„ν–‰
  β””β”€ score += μ μ (μ΄λ² ν μ μλ§ μ¦κ°€)
  β””β”€ updateUI() νΈμ¶

κ²μ„ μΆ…λ£ (μ •μƒ μΆ…λ£ or μ΄μ „ λ²„νΌ)
  β””β”€ await addGamePoints(score, 'gameId')
      β””β”€ ν†µν•© ν¬μΈνΈ += score
      β””β”€ Supabaseμ— μ €μ¥ (λ΅κ·ΈμΈ μ‹) or localStorage (λΉ„λ΅κ·ΈμΈ μ‹)
  β””β”€ totalPoints = getCurrentPoints()
  β””β”€ ν™”λ©΄μ— ν‘μ‹
      - μ΄λ²ν μ μ: score
      - ν†µν•© ν¬μΈνΈ: totalPoints
```

---

## 7. μ²΄ν¬λ¦¬μ¤νΈ

κ²μ„μ— μ μ μ‹μ¤ν…μ„ μ μ©ν•  λ• ν™•μΈ:

- [ ] `score` λ³€μλ” κ²μ„ μ‹μ‘ μ‹ `0`μΌλ΅ μ΄κΈ°ν™”
- [ ] κ²μ„ μΆ…λ£ μ‹ `await addGamePoints(score, 'gameId')` νΈμ¶
- [ ] μ΄μ „ λ²„νΌ ν΄λ¦­ μ‹μ—λ„ μ μ μ €μ¥
- [ ] Game Over ν™”λ©΄μ— "μ΄λ²ν μ μ"μ™€ "ν†µν•© ν¬μΈνΈ" λ‘ λ‹¤ ν‘μ‹
- [ ] `updatePointsDisplay()` ν•¨μλ΅ λ©”λ‰΄/κ²μ„μ¤λ²„ ν™”λ©΄ ν¬μΈνΈ μ—…λ°μ΄νΈ
- [ ] `handleGameExit(event)` ν•¨μ κµ¬ν„
- [ ] `.back-btn-game` μ¤νƒ€μΌ μ¶”κ°€
- [ ] Material Icons ν°νΈ λ΅λ“
- [ ] `confirm()` λ©”μ‹μ§€λ΅ μ‚¬μ©μ ν™•μΈ

---

## 8. μμ‹ μ½”λ“ (μµμ† ν…ν”λ¦Ώ)

### HTML
```html
<div id="gameContainer" class="game-container hidden">
    <div class="stats">
        <a href="#" class="back-btn-game" onclick="handleGameExit(event)">
            <span class="material-icons">arrow_back</span>
        </a>
        <div class="stat-item">
            <div class="stat-label">Score</div>
            <div class="stat-value" id="score">0</div>
        </div>
        <!-- κΈ°νƒ€ stat-item -->
    </div>
    <canvas id="gameCanvas"></canvas>
</div>
```

### JavaScript
```javascript
let score = 0;

async function startGame() {
    score = 0; // ν•­μƒ 0λ¶€ν„° μ‹μ‘
    // κ²μ„ μ΄κΈ°ν™”
}

async function endGame() {
    await addGamePoints(score, 'gameId');
    const totalPoints = getCurrentPoints();

    document.getElementById('finalScore').textContent = score.toLocaleString();
    document.getElementById('totalPoints').textContent = totalPoints.toLocaleString();
    // κ²μ„ μ¤λ²„ ν™”λ©΄ ν‘μ‹
}

async function handleGameExit(event) {
    event.preventDefault();
    if (gameState === 'playing' && confirm('κ²μ„μ„ μΆ…λ£ν•μ‹κ² μµλ‹κΉ?\nν„μ¬ μ μκ°€ ν†µν•© ν¬μΈνΈμ— μ €μ¥λ©λ‹λ‹¤.')) {
        await addGamePoints(score, 'gameId');
        updatePointsDisplay();
        // λ©”λ‰΄λ΅ λμ•„κ°€κΈ°
    }
}
```

---

## 9. κ²μ„λ³„ μ»¤μ¤ν„°λ§μ΄μ§•

κ° κ²μ„μ ν…λ§μ— λ§κ² μƒ‰μƒκ³Ό μ¤νƒ€μΌμ„ μ΅°μ •ν•μ„Έμ”:

### μƒ‰μƒ λ³€μ
```css
/* μ¤νƒ€μ›μ¦ X-Wing: λ…Έλ€μƒ‰/νλ€μƒ‰ */
.back-btn-game { color: #ffcc00; }
.stat-label { color: #ffcc00; }
border-bottom: 2px solid rgba(255, 204, 0, 0.5);

/* λ€ν¬ λ””νλ”: λ³΄λΌμƒ‰/μ΄λ΅μƒ‰ */
.back-btn-game { color: #a855f7; }
.stat-label { color: #4CAF50; }
border-bottom: 2px solid rgba(168, 85, 247, 0.5);

/* κ°¤λ­μ‹ μ›: νλ€μƒ‰/ν°μƒ‰ */
.back-btn-game { color: #4488ff; }
.stat-label { color: #4488ff; }
border-bottom: 2px solid rgba(68, 136, 255, 0.5);
```

### ν†µκ³„ ν•­λ© μ΅°μ •
κ²μ„μ— λ”°λΌ ν•„μ”ν• ν†µκ³„ ν•­λ©μ„ μ¶”κ°€/μ κ±°:
- Score (μ μ)
- Shields/HP (μ²΄λ ¥)
- Kills (μ²μΉ)
- Level (λ λ²¨)
- Wave (μ›¨μ΄λΈ)
- Combo (μ½¤λ³΄)

---

## 10. μ£Όμ” μ°¨μ΄μ  μ •λ¦¬

### β μλ»λ λ°©λ²•
```javascript
// κ²μ„ μ‹μ‘ μ‹ ν†µν•© ν¬μΈνΈλ¥Ό μ΄κΈ° μ μλ΅ μ‚¬μ©
const pointsResult = await usePointsForGameStart();
score = pointsResult.startingScore; // ν†µν•© ν¬μΈνΈ = κ²μ„ μ μ (νΌλ™λ¨)
```

### β… μ¬λ°”λ¥Έ λ°©λ²•
```javascript
// κ²μ„ μ‹μ‘ μ‹ ν•­μƒ 0λ¶€ν„°
score = 0; // μ΄λ² ν μ μ

// κ²μ„ μΆ…λ£ μ‹ ν†µν•© ν¬μΈνΈμ— μ¶”κ°€
await addGamePoints(score, 'gameId'); // scoreλ¥Ό ν†µν•© ν¬μΈνΈμ— λ”ν•κΈ°
const totalPoints = getCurrentPoints(); // μ—…λ°μ΄νΈλ ν†µν•© ν¬μΈνΈ
```

---

## 11. νΈλ¬λΈ”μν…

### λ¬Έμ : ν¬μΈνΈκ°€ λ‘ λ² μ λ¦½λ¨
**μ›μΈ:** `endGame()`κ³Ό `handleGameExit()` λ‘ λ‹¤ νΈμ¶
**ν•΄κ²°:** `handleGameExit()`μ—μ„ `gameState` μ²΄ν¬

### λ¬Έμ : μ΄μ „ λ²„νΌ ν΄λ¦­ μ‹ μ μκ°€ μ €μ¥ μ• λ¨
**μ›μΈ:** `event.preventDefault()` λΉ μ§
**ν•΄κ²°:** ν•¨μ μ‹μ‘μ— `event.preventDefault()` μ¶”κ°€

### λ¬Έμ : ν†µν•© ν¬μΈνΈκ°€ ν‘μ‹ μ• λ¨
**μ›μΈ:** `getCurrentPoints()` νΈμ¶ μ• ν•¨
**ν•΄κ²°:** `endGame()`μ—μ„ `getCurrentPoints()` νΈμ¶ ν›„ ν‘μ‹

---

μ΄ κ°€μ΄λ“λ¥Ό κΈ°μ¤€μΌλ΅ λ¨λ“  κ²μ„μ λ©”μΈ ν—¤λ”μ™€ μ μ μ‹μ¤ν…μ„ ν‘μ¤€ν™”ν•μ„Έμ”!
